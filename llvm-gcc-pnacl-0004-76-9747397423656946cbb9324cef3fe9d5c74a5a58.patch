# HG changeset patch
# User David Meyer <pdox@google.com>
# Date 1305932917 25200
# Branch pnacl-sfi
# Node ID 9747397423656946cbb9324cef3fe9d5c74a5a58
# Parent 8cd1425be45aa9a84dd1510e9feb9ebc641473e5
Make va_list 16-bytes instead of 24-bytes in llvm-gcc

 From llvm-gcc-pnacl-0004-76-9747397423656946cbb9324cef3fe9d5c74a5a58.patch

diff -r 8cd1425be45a llvm-gcc-4.2/gcc/tree.c
--- a/llvm-gcc-4.2/gcc/tree.c	Wed May 18 13:53:00 2011 -0700
+++ b/llvm-gcc-4.2/gcc/tree.c	Thu Jul 07 10:50:12 2011 -0700
@@ -6748,11 +6748,11 @@
       {
         /* If not expanding va_arg, make va_list large enough
            so that the generated bitcode will work on all platforms.
-           (e.g., X86-64 needs exactly 24-bytes for va_list) */
+           (in particular, NaCl X86-64 needs exactly 16-bytes for va_list) */
 
         t = build_array_type (
-                long_long_unsigned_type_node,
-                build_index_type (build_int_cst (NULL_TREE, 3-1)));
+                unsigned_type_node,
+                build_index_type (build_int_cst (NULL_TREE, 4-1)));
       }
     else
         t = targetm.build_builtin_va_list ();
